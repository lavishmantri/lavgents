# Nango Self-Hosted Setup
# Dashboard: http://localhost:3003

services:
  nango-db:
    image: postgres:17-alpine
    container_name: nango-db
    environment:
      POSTGRES_DB: nango
      POSTGRES_USER: nango
      POSTGRES_PASSWORD: ${NANGO_DB_PASSWORD:-nango}
    volumes:
      - nango-db-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U nango"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - nango-network

  nango-redis:
    image: redis:7-alpine
    container_name: nango-redis
    networks:
      - nango-network

  nango-server:
    image: nangohq/nango-server:hosted
    platform: linux/amd64
    container_name: nango-server
    depends_on:
      nango-db:
        condition: service_healthy
      nango-redis:
        condition: service_started
    ports:
      - "3003:8080"
      - "3009:3009"
    environment:
      NODE_ENV: development
      NANGO_DATABASE_URL: postgres://nango:${NANGO_DB_PASSWORD:-nango}@nango-db:5432/nango
      NANGO_REDIS_URL: redis://nango-redis:6379
      NANGO_SERVER_URL: ${NANGO_SERVER_URL:-http://localhost:3003}
      NANGO_SECRET_KEY: ${NANGO_SECRET_KEY:-b4875cd4-0f60-4ba6-aff1-6362bdb021b8}
      NANGO_PUBLIC_KEY: ${NANGO_PUBLIC_KEY:-19b92ee7-9bf9-4e5b-974d-d02405269d75}
      NANGO_ENCRYPTION_KEY: ${NANGO_ENCRYPTION_KEY:-E3r2AOp5uirYMTRJlw3NTe0HCE1WYnyBpjBjQc7tZ1Y=}
      NANGO_CALLBACK_URL: ${NANGO_CALLBACK_URL:-http://localhost:3003/oauth/callback}
      NANGO_TELEMETRY: false
      LOG_LEVEL: ${LOG_LEVEL:-debug}
      FLAG_AUTH_ENABLED: "false"
      FLAG_SERVE_CONNECT_UI: "true"
      NANGO_PUBLIC_CONNECT_URL: ${NANGO_PUBLIC_CONNECT_URL:-http://localhost:3009}
      NANGO_CONNECT_SESSION_TOKEN_SECRET: "connect-session-secret-for-local-dev"
      NANGO_DASHBOARD_USERNAME: "admin"
      NANGO_DASHBOARD_PASSWORD: "admin"
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:8080/health').then(r => process.exit(r.ok ? 0 : 1)).catch(() => process.exit(1))"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: always
    networks:
      - nango-network

volumes:
  nango-db-data:

networks:
  nango-network:
    driver: bridge
